2005-10-31  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_accel.c: (VIAInitAccel), (viaAccelClippingHelper),
	(viaAccelSolidHelper), (viaAccelTransparentHelper),
	(viaAccelCopyHelper), (VIASetupForScreenToScreenCopy),
	(VIASubsequentScreenToScreenCopy), (VIASetupForSolidFill),
	(VIASubsequentSolidFillRect), (VIASetupForMono8x8PatternFill),
	(VIASubsequentMono8x8PatternFillRect),
	(VIASetupForColor8x8PatternFill),
	(VIASubsequentColor8x8PatternFillRect),
	(VIASetupForCPUToScreenColorExpandFill),
	(VIASubsequentScanlineCPUToScreenColorExpandFill),
	(VIASetupForImageWrite), (VIASubsequentImageWriteRect),
	(VIASetupForSolidLine), (VIASubsequentSolidTwoPointLine),
	(VIASubsequentSolidHorVertLine), (VIASetupForDashedLine),
	(VIASubsequentDashedTwoPointLine), (VIASetClippingRectangle),
	(VIADisableClipping):
	* unichrome/via_dmabuffer.c: (viaFlushPCI), (viaFlushDma),
	(viaSetupCBuffer), (viaTearDownCBuffer):
	* unichrome/via_dmabuffer.h:
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_driver.h:

	-Moved accel command stream handling over to the same way it is
	 handled in the 3D and XvMC drivers.
	-First shot at cleaning up via_accel.c. Split up a number of helper
	 functions that will be used with EXA as well as XAA.
	-Worked around the VIA 2048 line blitter limit. The pixmap cache should
	 now be able to be unlimited in size.
	-Added dependence on fbOffset for future secondary accel.
	-Virtual correctness fixes (?).
	-The new files, via_dmabuffer.[ch] might be removed later.
	-Removed ScreenToScreenColorexpand since we don't have any info on how to
	 get it working.
	
	 I might have broken some accel functions. Non-DRI builds are temprarily broken.
	
2005-10-31  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):
	* unichrome/via_cursor.c: (VIAHWCursorInit):

	-Second attempt at fixing the hw cursor issue.
	 There were actually two errors involved.
	
2005-10-31  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_xvpriv.h:

	-Fix stray include left over by previous commit.
	
2005-10-31 Ivor Hewitt <ivor-at-ivor-dot-org>

	 * unichrome/via_id.c:

         -Mitac 8889 device id (Daniel Schindler)

2005-10-30  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):

	-Revert the hardware cursor fix since it for some strange reason
	 makes hw cursors white. Need to figure out why.
	
2005-10-30  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaInitVideo), (viaSetupAdaptors),
	(nv12cp), (viaDmaBlitImage), (viaPutImage), (nv12Blit):
	* unichrome/via_xvpriv.h:

	-Enable DMA Xv image transfers also for PM8X0 / CN400. 
	 YV12 to NV12 conversion is still software but now takes place 
	 in system memory instead of during transfer to framebuffer memory.
	 CPU usage is much improved on PM8X0. Less so on CN400. 
	 Hardware YV12 to NV12 conversion using the blitter was implemented
	 and tested but was very slow, probably due to the fact that blitting
	 only took place one column at a time. Since sync on the 2D engine 
	 currently requires a busy-wait, the approach was not only slow, but
	 also CPU-consuming.
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaExitVideo), (viaSaveVideo),
	(viaRestoreVideo), (VIAVidAdjustFrame):

	-Fix server crash when compiled without -DXvExtension.
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIADRIRingBufferInit), (VIADRIScreenInit),
	(VIADRIFinishScreenInit), (VIADRIMapInit):
	* unichrome/via_dri.h:
	* unichrome/via_driver.h:
	* unichrome/via_drm.h:
	* unichrome/via_memory.c: (VIAFreeLinear), (VIAAllocLinear):
	* unichrome/via_video.c: (viaInitVideo):
	* unichrome/via_xvmc.c: (ViaInitXVMC):

	-Sync dri handling with Xorg. This should hopefully make it run
	-with Mesa 6.4 again. (Luc Verhaegen, Eric Anholt, Me)

2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaPutImage):

	-Make via_video.c compile without -DXF86DRI. Broken with the
	-dmablit commit. (Reported by Luc Verhaegen)
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):

	-Fix HW cursor memory allocation.

2005-10-18  Ivor Hewitt <ivor-at-ivor-dot-org>

	* unichrome/via_bandwidth.c: (ViaSetPrimaryFIFO),
	(ViaSetSecondaryFIFO):
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_id.h:
	* unichrome/via_swov.c: (VIAVidHWDiffInit):

        -Remaining device id's lying about. 
        -Remove PM800 conditionals

2005-10-18  Ivor Hewitt <ivor-at-ivor-dot-org>

	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_id.h:
	* unichrome/via_mode.h:

	-Device id additions. AsRock P4VM800 reported by Mariano Benedettini

2005-09-25  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via.h:
	* unichrome/via_dri.c: (VIADRIRingBufferInit),
	(VIADRIFinishScreenInit):
	* unichrome/via_dri.h:
	* unichrome/via_driver.h:
	* unichrome/via_drm.h:
	* unichrome/via_priv.h:
	* unichrome/via_swov.c: (viaWaitHQVFlip), (viaWaitHQVFlipClear),
	(viaWaitHQVDone), (viaOverlayGetV1V3Format),
	(viaOverlayGetSrcStartAddress), (viaOverlayGetFetch),
	(viaSetColorSpace), (ViaSetVidCtl), (AddHQVSurface),
	(ViaSwovSurfaceCreate), (ViaSwovSurfaceDestroy),
	(SetFIFO_V3_64or32or32), (SetFIFO_V3_64or32or16), (SetColorKey),
	(SetChromaKey), (SetHQVFetch), (Upd_Video), (VIAVidUpdateOverlay),
	(ViaOverlayHide):
	* unichrome/via_video.c: (DecideOverlaySupport), (viaResetVideo),
	(viaSaveVideo), (viaExitVideo), (viaInitVideo), (viaReputImage),
	(viaSetupAdaptors), (viaStopVideo), (Flip), (nv12cp),
	(viaDmaBlitImage), (viaPutImage), (viaQueryImageAttributes):
	* unichrome/via_xvmc.c: (ViaInitXVMC):
	* unichrome/via_xvpriv.h:

	Big Xv update.
	-Bring Xv in sync with Xorg, which includes RV15 and RV16 support.
	-Add support for PCI DMA Xv image transfer. This requires DRM >= 2.7.0,
	 and does not yet work on Unichrome Pro group A, since YV12->NV12 hardware
	 conversion is not yet implemented. 
	
2005-08-13  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_swov.c: (ViaSwovSurfaceDestroy):

	-Destroy video surfaces on video exit / stop.

2005-08-13  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAAdjustFrame)

	-Fix Xv panning also for VBEModes.
	
2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAEnterVT):

	-Fix segfault on EnterVT when DRI is not enabled.
	 (Joris van Rantwijk)

2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_priv.h:
	* unichrome/via_swov.c: (VIAVidUpdateOverlay):
	* unichrome/via_video.c: (RegionsEqual), (viaReputImage),
	(viaSetupAdaptors), (VIAVidAdjustFrame):

	-Fix Xv panning. Speed up overlay updates on window moves.

2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaExitVideo):

	-Fix stopvideo for all ports and adaptors.
	
2005-08-10  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_bios.h:
	* unichrome/via_ch7xxx.c: (CH7xxxPrintRegs), (ViaCH7xxxDetect),
	(CH7xxxSave), (CH7xxxRestore), (CH7xxxDACSenseI2C),
	(CH7xxxDACSense), (CH7011ModeIndex), (CH7019ModeIndex),
	(CH7xxxModeValid), (CH7xxxModeI2C), (CH7xxxModeCrtc),
	(CH7xxxTVPower), (CH7019LCDPower), (ViaCH7xxxInit):
	* unichrome/via_ch7xxx.h:
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_mode.c: (ViaTVDetect), (ViaTVInit):
	* unichrome/via_vt162x.c: (ViaVT162xDetect), (VT1625DACSenseI2C),
	(VT1625DACSense), (VT1621ModeIndex), (VT1622ModeIndex),
	(VT1625ModeValid), (VT1622ModeI2C), (VT1622ModeCrtc),
	(VT1625Power), (ViaVT162xInit):
	* unichrome/via_vt162x.h:

        -Initial steps to incorporating CH7xxx and VT1625 support
        merging patches from David George, Philip Prindeville, Terry Lewis

2005-07-30  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* libxvmc/Imakefile:
	* unichrome/via_mode.c: (ViaGetMemoryBandwidth),
	(ViaModePrimaryVGA), (ViaModePrimary):
	* unichrome/via_swov.c:

	-Merge fixes from xorg for typos in mode setting and sync set

2005-07-18  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/via_id.c:

	-Additional card-id. Reported by Philip Prindeville

2005-07-04  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAPreInit), (VIAScreenInit):
	* unichrome/via_id.c:

	-Avoid calling DPMS to blank screen during init with VBEModes
	-Add another card ID.
	
2005-06-29  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/via_id.c:

	-Additional card-ids. Patch from Xavier Bachelot
	
2005-06-26  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/viaLowLevelPro.c: (finish_header_agp), (syncDMA),
	(syncVideo), (pciFlush), (agpFlush), (uploadHQVDeinterlace),
	(uploadHQVShadow), (flushXvMCLowLevel), (flushPCIXvMCLowLevel),
	(viaMpegSetSurfaceStride), (viaVideoSetSWFLipLocked),
	(viaVideoSWFlipLocked), (viaMpegSetFB), (viaMpegBeginPicture),
	(viaMpegReset), (viaMpegWriteSlice), (viaVideoSubPictureOffLocked),
	(viaVideoSubPictureLocked), (viaBlit), (syncXvMCLowLevel),
	(releaseXvMCLowLevel), (initXvMCLowLevel), (closeXvMCLowLevel):

	-Clean up the VIDEO_DMA ifdef mess before xorg inclusion. 
	-Make VIDEO_DMA wait for DMA quiescent before flipping, pending proper
	 HQV locking.
	-Disable VIDEO_DMA to improve latency pending proper HQV locking.

2005-06-17  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_mode.c: (ViaSetPrimaryDotclock),
	(ViaSetSecondaryDotclock), (ViaComputeProDotClock),
	(ViaModeDotClockTranslate):

	- Free dotclock on Unichrome Pro. Pls report problems with 
	  unstable clocks.
	- Minor 64-bit fixes.

2005-06-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_xvmc.c: (ViaXvMCCreateContext),
	(ViaXvMCCreateSurface), (ViaXvMCCreateSubpicture):
	* unichrome/via_xvmc.h:

	- XvMC 64 bit fixes. XvMC now runs on K8M800 64-bit Linux.
	
2005-06-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_bios.h:
	* unichrome/via_i2c.c:
	* unichrome/via_mode.c: (ViaTVRestore):
	* unichrome/via_vt162x.c: (VT162xPrintRegs), (ViaVT162xDetect),
	(VT162xSave), (VT162xRestore), (ViaVT162xInit):

	- Fix up the vt1623 encoder: Correct device ID, number of registers
	  and most of all reading from the i2cbus it is sitting on.

2005-06-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIADRIScreenInit):

	- Update via_dri.c to compile with new libdri.
	
2005-06-01  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_mode.c: (ViaModePrimary):
	* unichrome/via_vt162x.h:

	- Fix TV-out on Unichrome Pro. To make it work CRT+TV needs to be
	  enabled in BIOS. Still it will hang the machine or possibly only
	  the display chip on X server exit.
	- Import the 720x576Noscale mode for vt1622A/vt1623 from the Unichrome
	  driver (Terry Barnaby)

2005-05-25  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/viaLowLevelPro.c: (setHQVDeinterlacing):
	* libxvmc/viaXvMC.c:
	* unichrome/via_driver.c:
	* unichrome/via_mode.c: (ViaModePrimary):
	* unichrome/via_mode.h:
	* unichrome/via_vt162x.c: (ViaVT162xDetect):

	- Updated incorrect field order in libViaXvMCPro.
	- Fixed warnings about unresolved int10 symbols in the Unichrome driver.
	- Updated Unichrome Pro dotclocks - also for TV.
	- Made the driver recognize the vt1623 TV encoder on the EPIA SP13000.
	- Removed unnecessary define in viaXvMC.c.
	
2005-05-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/driDrawable.c: (getDRIDrawableInfoLocked):
	* libxvmc/viaXvMC.c: (releaseContextResources),
	(XvMCCreateContext):
	* libxvmc/xf86dri.c: (uniDRIDestroyContext),
	(uniDRICreateDrawable), (uniDRIDestroyDrawable),
	(uniDRIGetDrawableInfo):
	* libxvmc/xf86dri.h:

	- Changed DRI client function names since they clash with
	  via_dri.so, causing strange problems in, for example, xine.
	
2005-05-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIASetAgpMode), (VIADRIAgpInit):

	- Added better AGP mode control to the DDX.

2005-05-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* prepare-ChangeLogSVN.pl:

	- Added the above file for generation of ChangeLog Entries.

	
2005-05-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>
	
	* libxvmc/driDrawable.c:
	* libxvmc/viaLowLevel.c: (hwlLock), (hwlUnlock),
	(setAGPSyncLowLevel), (viaDMATimeStampLowLevel),
	(flushXvMCLowLevel), (flushPCIXvMCLowLevel),
	(viaMpegSetSurfaceStride), (viaVideoSetSWFLipLocked),
	(viaVideoSWFlipLocked), (viaMpegSetFB), (viaMpegBeginPicture),
	(viaMpegReset), (viaMpegWriteSlice), (viaVideoSubPictureOffLocked),
	(viaVideoSubPictureLocked), (viaBlit), (syncXvMCLowLevel),
	(initXvMCLowLevel), (setLowLevelLocking), (closeXvMCLowLevel):
	* libxvmc/viaLowLevel.h:
	* libxvmc/viaLowLevelPro.c: (initHQVShadow),
	(setHQVHWDeinterlacing), (setHQVDeblocking), (setHQVStartAddress),
	(setHQVColorSpaceConversion), (setHQVFetchLine), (setHQVScale),
	(setHQVSingleDestination), (setHQVDeinterlacing),
	(setHQVTripleBuffer), (hwlLock), (hwlUnlock), (setAGPSyncLowLevel),
	(viaDMATimeStampLowLevel), (viaDMAInitTimeStamp),
	(uploadHQVDeinterlace), (uploadHQVShadow), (flushXvMCLowLevel),
	(flushPCIXvMCLowLevel), (viaMpegSetSurfaceStride),
	(viaVideoSetSWFLipLocked), (viaVideoSWFlipLocked), (viaMpegSetFB),
	(viaMpegBeginPicture), (viaMpegReset), (viaMpegWriteSlice),
	(viaVideoSubPictureOffLocked), (viaVideoSubPictureLocked),
	(viaBlit), (syncXvMCLowLevel), (updateLowLevelBuf),
	(cleanupLowLevelBuf), (initXvMCLowLevel), (setLowLevelLocking),
	(closeXvMCLowLevel), (computeDownScaling),
	(computeHQVScaleAndFilter), (setupBackBuffer):
	* libxvmc/viaXvMC.c: (grabDecoder), (releaseContextResources),
	(XvMCCreateContext), (XvMCCreateSurface), (XvMCPutSlice2),
	(XvMCPutSlice), (XvMCPutSurface), (XvMCBeginSurface),
	(XvMCSyncSurface), (XvMCLoadQMatrix), (XvMCCreateSubpicture),
	(XvMCSetSubpicturePalette), (XvMCClearSubpicture),
	(XvMCCompositeSubpicture), (XvMCBlendSubpicture2),
	(XvMCSyncSubpicture), (XvMCDestroySubpicture), (XvMCFlushSurface),
	(XvMCGetSurfaceStatus), (XvMCQueryAttributes), (XvMCSetAttribute),
	(XvMCGetAttribute), (XvMCHideSurface):
	* libxvmc/viaXvMCPriv.h:
	* unichrome/via_swov.c: (ViaSwovSurfaceCreate):
	* unichrome/via_video.c: (viaSetupAdaptors):
	* unichrome/via_xvpriv.h:

	- Added ChangeLog to the repository.
	- Made the DDX update the overlay if a change in surface format occured
	  while it's dimensions are still the same.
	- Made the XvMCLowLevel struct opaque (void *) and not defined in the 
	  header file. This allows for different definitions for different hardware
	- Added a HQV shadow which holds the HQV context for the Unichrome Pro. 
	  The purpose is twofold:
	  1. If someone else touched the HQV since we last used it, we can upload the
	     whole context.
	  2. We do not need to read from the HQV, which is bad because we have to 
	     halt the DMA engine to do that.
	- Added and activated mpeg deblocking for Unichrome Pro.
	- Added a number of HQV utility functions for the upcoming video engine free
	  output. These are not activated yet. (Unichrome Pro.)
	- Added HW deinterlacing functions. Deactivated, since I cannot see any visible
	  difference. (Unichrome Pro.)
