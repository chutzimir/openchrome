2006-01-29  Thomas Hellström <thomas-at-tungstengraphics-dot-com>

	* unichrome/via_accel.c: (viaInitExa):
	* unichrome/via_driver.c: (VIAPreInit):

	- Minor bugfixes.
	
2006-01-27  Thomas Hellström <thomas-at-tungstengraphics-dot-com>

	* unichrome/via.man:
	* unichrome/via_3d.c:
	* unichrome/via_accel.c: (viaAccelPlaneMaskHelper), (viaInitExa),
	(viaExitAccel), (viaFinishInitAccel):
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_driver.h:

	- Options - Planemask - and manual fixes.

2006-01-12  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaExaDownloadFromScreen),
	(viaExaTexUploadToScreen), (viaExaUploadToScreen):

	- Pointer target signedness fixes.
	
2006-01-11  Thomas Hellström <unichrome-at-shipmail-dot-org>  

	* unichrome/via_accel.c: (viaExaDownloadFromScreen),
	(viaExaTexUploadToScreen), (viaExaUploadToScreen),
	(viaExaCheckComposite):
	* unichrome/via_driver.h:

	- Add min sizes below which we fall back to software rendering for
	  maximum speed.
	- Explicit sync in uploadToScreen and downloadFromScreen. Without this, 
	  mozilla scrolling gives rendering errors. Probably an EXA bug.

2006-01-08  Thomas Hellström <unichrome-at-shipmail-dot-org>  

	* unichrome/via_accel.c: (viaPixelARGB8888):

	- Set one-pixel path alpha to 0xFF when the picture format doesn't
	  contain alpha. Fixes openOffice drawing artifacts.
	
2006-01-08  Thomas Hellström <unichrome-at-shipmail-dot-org> 

	* unichrome/via_3d.c: (viaSet3DFlags), (viaSet3DCompositeOperator):
	* unichrome/via_accel.c: (viaIsAGP):

	- Fixed partial upload of state that was causing rendering errors after
	  viaExaTexUploadToScreen.
	- Fixed AGP offset calculation that caused rendering errors after
	  viaExaUploadToScratch.

2006-01-07  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/via_3d.c: (via3DDstFormat), (via3DTexFormat),
	(via3DDstSupported), (via3DTexSupported), (viaSet3DDestination),
	(viaSet3DTexture), (viaSet3DCompositeOperator), (via3DOpSupported),
	(via3DEmitQuad), (via3DEmitClipRect), (viaInit3DState):
	* unichrome/via_3d.h:
	* unichrome/via_accel.c: (viaSetupCBuffer),
	(viaAccelPlaneMaskHelper), (viaCheckUpload),
	(viaExaDownloadFromScreen), (viaExaTexUploadToScreen),
	(viaExaUploadToScreen), (viaExaUploadToScratch),
	(viaExaCheckComposite), (viaIsAGP), (viaIsOffscreen),
	(viaExaPrepareComposite), (viaExaComposite), (viaInitExa),
	(viaInitAccel), (viaExitAccel), (viaFinishInitAccel):
	* unichrome/via_dri.c: (VIADRIFBInit):
	* unichrome/via_driver.h:

	- Bugfixes and optimizations. Only sort-of important composite operation that
	  is not supported ATM is the A8 xor A8. 
	
2006-01-06  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_3d.c: (viaSet3DDestination), (viaSet3DDrawing),
	(viaSet3DFlags), (viaOrder), (viaSet3DTexture),
	(viaSet3DTexBlendCol), (viaSet3DCompositeOperator),
	(via3DEmitQuad), (via3DEmitState), (viaInit3DState):
	* unichrome/via_3d.h:
	* unichrome/via_accel.c: (viaDumpDMA), (viaFlushDRIEnabled),
	(viaSetupCBuffer), (viaExaPrepareCopy), (viaExaCompositePictDesc),
	(viaExaPrintComposite), (viaBitExpandHelper), (viaPixelARGB8888),
	(viaExpandablePixel), (viaCheckUpload), (viaOrder),
	(viaExaDownloadFromScreen), (viaExaTexUploadToScreen),
	(viaExaUploadToScreen), (viaExaCheckComposite),
	(viaExaPrepareComposite), (viaExaComposite), (viaInitExa),
	(viaInitAccel), (viaExitAccel), (viaFinishInitAccel),
	(viaAccelBlitRect), (viaAccelFillRect), (viaAccelSyncMarker):
	* unichrome/via_dga.c:
	* unichrome/via_dmabuffer.h:
	* unichrome/via_driver.c: (VIAScreenInit):
	* unichrome/via_driver.h:

	- Sort of working composite acceleration. Some things are still slow, 
	  some picture formats not implemented, and single pixel mask is 
	  probably somewhat buggy. But translucent windows and window shadows
	  work nicely, although not at Nvidia speeds.

2005-12-27  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaExaPrepareCopy),
	(viaExaCheckComposite), (viaExaPrepareComposite),
	(viaExaComposite), (viaExaUploadToScreen), (viaInitExa),
	(viaInitAccel), (viaOrder), (viaFinishInitAccel),
	(viaSet3DDestination), (viaSet3DBlending), (viaSet3Dflags),
	(viaSet3DDrawing), (viaSet3DTexture), (viaEmit3DState),
	(viaEmitQuad), (test3d), (viaExaTexUploadToScreen):
	* unichrome/via_driver.c: (VIAScreenInit):
	* unichrome/via_driver.h:

	- Implement an experimental upload to screen using AGP texturing.
	  Works nicely on K8M800 but requires DRI to hand us AGP memory.
	- Various temporary testing code implemented.
	- Various 3D fixes. Probably broke AGP DMA (due to command alignments)
	  on the way.

2005-12-16  Thomas Hellström <unichrome-at-shipmail-dot-org>  

	* unichrome/via_accel.c: (viaFlushPCI), (viaFlushDRIEnabled),
	(viaSetupCBuffer), (viaSubsequentColor8x8PatternFillRect),
	(viaSetupForCPUToScreenColorExpandFill),
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSetupForImageWrite), (viaSubsequentImageWriteRect),
	(viaSetupForSolidLine), (viaSubsequentSolidTwoPointLine),
	(viaSubsequentSolidHorVertLine), (viaSetupForDashedLine),
	(viaExaPrepareSolid), (viaExaSolid), (viaExaPrepareCopy),
	(viaExaCopy), (viaDGABlitRect), (viaDGAFillRect),
	(viaSet3DTexture), (viaEmit3DState), (test3d):
	* unichrome/via_dmabuffer.h:
	* unichrome/via_driver.c: (VIALeaveVT), (VIAWriteMode),
	(VIACloseScreen):
	* unichrome/via_driver.h:

	- Some formatting fixes.
	- Enable 3D engine when EXA is compiled in, even if DRI is not enabled.
	- Extend the local command buffer parser to handle header2 3D commands.

	We can now use the 3D functions without DRI.
	
2005-12-15  Thomas Hellström <unichrome-at-shipmail-dot-org>  

	* unichrome/Imakefile:
	* unichrome/via_3d_reg.h:
	* unichrome/via_accel.c: (viaFlushDRIEnabled),
	(viaAccelClippingHelper), (viaAccelSolidHelper),
	(viaAccelTransparentHelper), (viaAccelCopyHelper),
	(viaSetupForScreenToScreenCopy), (viaSubsequentScreenToScreenCopy),
	(viaSetupForSolidFill), (viaSubsequentSolidFillRect),
	(viaSetupForMono8x8PatternFill),
	(viaSubsequentMono8x8PatternFillRect),
	(viaSetupForColor8x8PatternFill),
	(viaSubsequentColor8x8PatternFillRect),
	(viaSetupForCPUToScreenColorExpandFill),
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSetupForImageWrite), (viaSubsequentImageWriteRect),
	(viaSetupForSolidLine), (viaSubsequentSolidTwoPointLine),
	(viaSubsequentSolidHorVertLine), (viaSetupForDashedLine),
	(viaAccelMarkSync), (viaExaPrepareSolid), (viaExaSolid),
	(viaExaPrepareCopy), (viaExaCopy), (viaInitAccel),
	(viaDGABlitRect), (viaDGAFillRect), (viaSet3DDestination),
	(viaSet3DBlending), (viaSet3Dflags), (viaSet3DDrawing), (viaOrder),
	(viaSet3DTexture), (viaEmit3DState), (viaEmitQuad), (test3d):
	* unichrome/via_dmabuffer.h:
	* unichrome/via_driver.h:

	- Renamed and extended ring-buffer macros.
	- Added ring-buffer macros for 3D engine AGP DMA.
	- Added stripped down functions for basic 3D engine
	
	  *solid color drawing
	  *alpha blending
	  *texturing
	  *multitexturing
		
          These will be used to accelerate composite, but composite callbacks
	  are not yet implemented.

R2005-12-02  Thomas Hellström  <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaAccelPlaneMaskHelper),
	(viaAccelTransparentHelper), (viaSetupForScreenToScreenCopy),
	(viaSetupForSolidFill), (viaSetupForMono8x8PatternFill),
	(viaSetupForColor8x8PatternFill),
	(viaSetupForCPUToScreenColorExpandFill), (viaSetupForImageWrite),
	(viaSetupForSolidLine), (viaSubsequentSolidTwoPointLine),
	(viaSetupForDashedLine), (viaAccelMarkSync), (viaExaPrepareSolid),
	(viaExaPrepareCopy), (viaInitAccel), (viaDGABlitRect),
	(viaDGAFillRect):
	* unichrome/via_driver.c:
	* unichrome/via_driver.h:

	- Add support for EXA planemasks.
	- Tell loader about some missing EXA functions (Reported by Adam Jackson).
	- Fix broken XAA dashed lines.

2005-11-29  Thomas Hellström  <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaInitAccel):
	* unichrome/via_memory.c: (VIAAllocLinear):

	- Small cleanup of via_memory.c
	- Make via_accel.c build without XF86DRI 
	
2005-11-26  Thomas Hellström  <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaFlushDRIEnabled), (viaSetupCBuffer):

	- Fix possible accel segfault.
	- Don't submit an empty AGP command stream to the DRM.
	
2005-11-17  Thomas Hellström <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaFlushPCI), (viaFlushDRIEnabled),
	(viaSetupCBuffer), (viaTearDownCBuffer), (viaEnableVQ),
	(viaDisableVQ), (viaAccelSetMode), (viaInitialize2DEngine),
	(viaAccelSync), (viaSetClippingRectangle),
	(viaAccelClippingHelper), (viaAccelSolidHelper),
	(viaAccelTransparentHelper), (viaAccelCopyHelper),
	(viaSetupForScreenToScreenCopy), (viaSubsequentScreenToScreenCopy),
	(viaSetupForSolidFill), (viaSubsequentSolidFillRect),
	(viaSetupForMono8x8PatternFill),
	(viaSubsequentMono8x8PatternFillRect),
	(viaSetupForColor8x8PatternFill),
	(viaSubsequentColor8x8PatternFillRect),
	(viaSetupForCPUToScreenColorExpandFill),
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSetupForImageWrite), (viaSubsequentImageWriteRect),
	(viaSetupForSolidLine), (viaSubsequentSolidTwoPointLine),
	(viaSubsequentSolidHorVertLine), (viaSetupForDashedLine),
	(viaSubsequentDashedTwoPointLine), (viaInitXAA),
	(viaAccelMarkSync), (viaAccelWaitMarker), (viaExaPrepareSolid),
	(viaExaSolid), (viaExaPrepareCopy), (viaExaCopy),
	(viaExaDownloadFromScreen), (viaExaUploadToScreen), (viaInitExa),
	(viaInitAccel), (viaExitAccel), (viaDGABlitRect), (viaDGAFillRect):

	- Run indent on via_accel.c

2005-11-16  Thomas Hellström <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaSetupForCPUToScreenColorExpandFill),
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSubsequentImageWriteRect), (viaSubsequentSolidTwoPointLine),
	(viaInitXAA), (viaAccelMarkSync), (viaInitAccel):

	- Add some comments and mask out the marker sign bit also when AGP
	  is not used.

2005-11-15  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_accel.c: (viaAccelSolidHelper),
	(viaAccelCopyHelper):
	* unichrome/via_driver.c: (VIAScreenInit):

	- Fix Imakefile warning when EXA is not available.
	- Fix compilation warning about mixed declarations and code.
	- Fix K8M800 stride setting.
	
2005-11-15  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaExaUploadToScreen):

	- Fix some compilation warnings introduced by last commit.
	
2005-11-14  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaTearDownCBuffer),
	(viaExaDownloadFromScreen), (viaExaUploadToScreen):

	- Work around an apparent DMA upload bug.
	- Add some code comments.
	- Protect with directrenderingenabled flag.

2005-11-09  Thomas Hellström  <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaAccelMarkSync), (viaAccelWaitMarker),
	(viaInitExa):
	* unichrome/via_driver.h:

	-Nope, some bugs left: 
	 Don't enable up/download to screen unless DRI is enabled.
	 Avoid referencing removed functions.

2005-11-09  Thomas Hellström <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaAccelSetMode), (viaInitXAA),
	(viaExaSolid), (viaExaCopy), (viaExaDownloadFromScreen),
	(viaExaUploadToScreen), (viaInitExa), (viaInitAccel),
	(viaDGAWaitMarker):
	* unichrome/via_dri.c: (VIADRIFBInit):
	* unichrome/via_driver.c: (VIAPreInit), (VIAScreenInit),
	(VIASwitchMode):
	* unichrome/via_driver.h:

	-Frame-buffer memory and pitch alignment fixes.
	 Replaced a lot of virtualX with displayWidth,
	 Fixed pitch increment, which primarily fixes 8-bit modes
	 which were previously broken. Time for merge?
	
2005-11-07  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c:
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSubsequentImageWriteRect):
	* unichrome/via_memory.c: (VIAInitLinear):

	-Fix XAA clipping and a possible bug in VIAInitLinear
	
2005-11-06 Thomas Hellström  <unichrome-at-shipmail-dot-org> 

	* unichrome/via_accel.c: (viaAccelWaitMarker),
	(viaExaDownloadFromScreen), (viaExaUploadToScreen), (viaInitExa),
	(viaBlitSyncPushBack), (viaBlitSyncMarker):
	* unichrome/via_dri.c: (VIADRIScreenInit),
	(VIADRIFinishScreenInit):
	* unichrome/via_driver.h:

	-EXA PCI DMA upload to and download from screen. Upload only 
	 when alignments match. Download uses bounce-buffer if 
	 alignments are illegal. Move DRM version collect to before
	 accel init to be able to detect PCI dma-supporting versions.
	
2005-11-05 Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaFlushDRIEnabled), (viaSetupCBuffer),
	(viaAccelMarkSync), (viaAccelWaitMarker), (viaInitExa),
	(viaDGABlitRect), (viaDGAFillRect), (viaDGAWaitMarker):
	* unichrome/via_dga.c:
	* unichrome/via_driver.c: (VIAScreenInit):
	* unichrome/via_driver.h:

	-Adapt DGA to new acceleration design (untested). 
	 Fix AGP DMA usage.
	
2005-11-05 Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_accel.c: (viaFlushPCI), (viaFlushAGP),
	(viaSetupCBuffer), (viaTearDownCBuffer), (viaInitAccel):
	* unichrome/via_dmabuffer.c:
	* unichrome/via_dmabuffer.h:
	* unichrome/via_dri.c: (VIADRIFBInit), (VIADRICloseScreen):
	* unichrome/via_driver.c: (VIAScreenInit):
	* unichrome/via_driver.h:
	* unichrome/via_memcpy.c: (viaVidCopyInit):
	* unichrome/via_memory.c: (offScreenLinear):

	-Fix DRI and NoAccel path. Incorporate via_dmabuffer.c into 
	 via_accel.c

2005-11-05 Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaInitAccel), (viaExitAccel):
	* unichrome/via_driver.c: (VIACloseScreen):
	* unichrome/via_driver.h:

	-Fix XAA segfault, do proper teardown when X exits.
	
2005-11-04 Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_accel.c: (viaAccelSetMode),
	(viaInitialize2DEngine), (viaExaPrepareSolid), (viaExaSolid),
	(viaExaDoneSolidCopy), (viaExaPrepareCopy), (viaExaCopy),
	(viaExaWaitMarker), (viaExaDownloadFromScreen),
	(viaExaUploadToScreen), (viaExaMarkSync), (viaExaUploadToScratch),
	(viaExaScratchSave), (viaInitExa), (viaInitAccel):
	* unichrome/via_driver.c: (VIASetup), (VIAPreInit),
	(VIAScreenInit), (VIACloseScreen):
	* unichrome/via_driver.h:
	* unichrome/via_memory.c: (VIAFreeLinear), (offScreenLinear),
	(VIAAllocLinear), (VIAInitLinear):
	* unichrome/via_priv.h:

	-First somewhat working Exa version. Seems to segfault when compiled without EXA.
	 Some features still missing, like driver structure teardown, and up- and download to
	 screen. Still breaks DRI and apparently segfaults when built without -DVIA_HAVE_EXA.

2005-11-01  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaInitAgp), (viaEnableVQ),
	(viaDisableVQ), (viaInitialize2DEngine), (viaAccelSync),
	(viaSetClippingRectangle), (viaDisableClipping),
	(viaAccelCopyHelper), (viaSetupForScreenToScreenCopy),
	(viaSubsequentScreenToScreenCopy), (viaSetupForSolidFill),
	(viaSubsequentSolidFillRect), (viaSetupForMono8x8PatternFill),
	(viaSubsequentMono8x8PatternFillRect),
	(viaSetupForColor8x8PatternFill),
	(viaSubsequentColor8x8PatternFillRect),
	(viaSetupForCPUToScreenColorExpandFill),
	(viaSubsequentScanlineCPUToScreenColorExpandFill),
	(viaSetupForImageWrite), (viaSubsequentImageWriteRect),
	(viaSetupForSolidLine), (viaSubsequentSolidTwoPointLine),
	(viaSubsequentSolidHorVertLine), (viaSetupForDashedLine),
	(viaSubsequentDashedTwoPointLine), (viaExaMarkSync), (viaInitXAA),
	(viaInitAccel):
	* unichrome/via_cursor.c: (VIALoadCursorImage):
	* unichrome/via_dga.c:
	* unichrome/via_driver.c: (VIALeaveVT), (VIAScreenInit),
	(VIAWriteMode), (VIACloseScreen), (VIASwitchMode):
	* unichrome/via_driver.h:
	* unichrome/via_vbe.c: (ViaVbeSetMode):

	-Name changes and further cleanups. Now down more than 500 lines
	 on via_accel.c

2005-11-01  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (viaAccelClippingHelper),
	(viaAccelSolidHelper), (viaAccelCopyHelper),
	(VIASubsequentScreenToScreenCopy), (VIASetupForSolidFill),
	(VIASubsequentSolidFillRect),
	(VIASubsequentMono8x8PatternFillRect),
	(VIASubsequentColor8x8PatternFillRect),
	(VIASubsequentScanlineCPUToScreenColorExpandFill),
	(VIASubsequentImageWriteRect), (VIASubsequentSolidTwoPointLine),
	(VIASubsequentSolidHorVertLine), (viaExaMarkSync):

	-Fixed a number of bugs including accelerated clipping, which could
	 end up with negative y values.

2005-10-31  Thomas Hellström <unichrome-at-shipmail-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_accel.c: (VIAInitAccel), (viaAccelClippingHelper),
	(viaAccelSolidHelper), (viaAccelTransparentHelper),
	(viaAccelCopyHelper), (VIASetupForScreenToScreenCopy),
	(VIASubsequentScreenToScreenCopy), (VIASetupForSolidFill),
	(VIASubsequentSolidFillRect), (VIASetupForMono8x8PatternFill),
	(VIASubsequentMono8x8PatternFillRect),
	(VIASetupForColor8x8PatternFill),
	(VIASubsequentColor8x8PatternFillRect),
	(VIASetupForCPUToScreenColorExpandFill),
	(VIASubsequentScanlineCPUToScreenColorExpandFill),
	(VIASetupForImageWrite), (VIASubsequentImageWriteRect),
	(VIASetupForSolidLine), (VIASubsequentSolidTwoPointLine),
	(VIASubsequentSolidHorVertLine), (VIASetupForDashedLine),
	(VIASubsequentDashedTwoPointLine), (VIASetClippingRectangle),
	(VIADisableClipping):
	* unichrome/via_dmabuffer.c: (viaFlushPCI), (viaFlushDma),
	(viaSetupCBuffer), (viaTearDownCBuffer):
	* unichrome/via_dmabuffer.h:
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_driver.h:

	-Moved accel command stream handling over to the same way it is
	 handled in the 3D and XvMC drivers.
	-First shot at cleaning up via_accel.c. Split up a number of helper
	 functions that will be used with EXA as well as XAA.
	-Worked around the VIA 2048 line blitter limit. The pixmap cache should
	 now be able to be unlimited in size.
	-Added dependence on fbOffset for future secondary accel.
	-Virtual correctness fixes (?).
	-The new files, via_dmabuffer.[ch] might be removed later.
	-Removed ScreenToScreenColorexpand since we don't have any info on how to
	 get it working.
	
	 I might have broken some accel functions. Non-DRI builds are temprarily broken.
	
2005-10-31  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):
	* unichrome/via_cursor.c: (VIAHWCursorInit):

	-Second attempt at fixing the hw cursor issue.
	 There were actually two errors involved.
	
2005-10-31  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_xvpriv.h:

	-Fix stray include left over by previous commit.
	
2005-10-31 Ivor Hewitt <ivor-at-ivor-dot-org>

	 * unichrome/via_id.c:

         -Mitac 8889 device id (Daniel Schindler)

2005-10-30  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):

	-Revert the hardware cursor fix since it for some strange reason
	 makes hw cursors white. Need to figure out why.
	
2005-10-30  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaInitVideo), (viaSetupAdaptors),
	(nv12cp), (viaDmaBlitImage), (viaPutImage), (nv12Blit):
	* unichrome/via_xvpriv.h:

	-Enable DMA Xv image transfers also for PM8X0 / CN400. 
	 YV12 to NV12 conversion is still software but now takes place 
	 in system memory instead of during transfer to framebuffer memory.
	 CPU usage is much improved on PM8X0. Less so on CN400. 
	 Hardware YV12 to NV12 conversion using the blitter was implemented
	 and tested but was very slow, probably due to the fact that blitting
	 only took place one column at a time. Since sync on the 2D engine 
	 currently requires a busy-wait, the approach was not only slow, but
	 also CPU-consuming.
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaExitVideo), (viaSaveVideo),
	(viaRestoreVideo), (VIAVidAdjustFrame):

	-Fix server crash when compiled without -DXvExtension.
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIADRIRingBufferInit), (VIADRIScreenInit),
	(VIADRIFinishScreenInit), (VIADRIMapInit):
	* unichrome/via_dri.h:
	* unichrome/via_driver.h:
	* unichrome/via_drm.h:
	* unichrome/via_memory.c: (VIAFreeLinear), (VIAAllocLinear):
	* unichrome/via_video.c: (viaInitVideo):
	* unichrome/via_xvmc.c: (ViaInitXVMC):

	-Sync dri handling with Xorg. This should hopefully make it run
	-with Mesa 6.4 again. (Luc Verhaegen, Eric Anholt, Me)

2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaPutImage):

	-Make via_video.c compile without -DXF86DRI. Broken with the
	-dmablit commit. (Reported by Luc Verhaegen)
	
2005-10-27  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_accel.c: (VIAInitAccel):

	-Fix HW cursor memory allocation.

2005-10-18  Ivor Hewitt <ivor-at-ivor-dot-org>

	* unichrome/via_bandwidth.c: (ViaSetPrimaryFIFO),
	(ViaSetSecondaryFIFO):
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_id.h:
	* unichrome/via_swov.c: (VIAVidHWDiffInit):

        -Remaining device id's lying about. 
        -Remove PM800 conditionals

2005-10-18  Ivor Hewitt <ivor-at-ivor-dot-org>

	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_id.h:
	* unichrome/via_mode.h:

	-Device id additions. AsRock P4VM800 reported by Mariano Benedettini

2005-09-25  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via.h:
	* unichrome/via_dri.c: (VIADRIRingBufferInit),
	(VIADRIFinishScreenInit):
	* unichrome/via_dri.h:
	* unichrome/via_driver.h:
	* unichrome/via_drm.h:
	* unichrome/via_priv.h:
	* unichrome/via_swov.c: (viaWaitHQVFlip), (viaWaitHQVFlipClear),
	(viaWaitHQVDone), (viaOverlayGetV1V3Format),
	(viaOverlayGetSrcStartAddress), (viaOverlayGetFetch),
	(viaSetColorSpace), (ViaSetVidCtl), (AddHQVSurface),
	(ViaSwovSurfaceCreate), (ViaSwovSurfaceDestroy),
	(SetFIFO_V3_64or32or32), (SetFIFO_V3_64or32or16), (SetColorKey),
	(SetChromaKey), (SetHQVFetch), (Upd_Video), (VIAVidUpdateOverlay),
	(ViaOverlayHide):
	* unichrome/via_video.c: (DecideOverlaySupport), (viaResetVideo),
	(viaSaveVideo), (viaExitVideo), (viaInitVideo), (viaReputImage),
	(viaSetupAdaptors), (viaStopVideo), (Flip), (nv12cp),
	(viaDmaBlitImage), (viaPutImage), (viaQueryImageAttributes):
	* unichrome/via_xvmc.c: (ViaInitXVMC):
	* unichrome/via_xvpriv.h:

	Big Xv update.
	-Bring Xv in sync with Xorg, which includes RV15 and RV16 support.
	-Add support for PCI DMA Xv image transfer. This requires DRM >= 2.7.0,
	 and does not yet work on Unichrome Pro group A, since YV12->NV12 hardware
	 conversion is not yet implemented. 
	
2005-08-13  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_swov.c: (ViaSwovSurfaceDestroy):

	-Destroy video surfaces on video exit / stop.

2005-08-13  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAAdjustFrame)

	-Fix Xv panning also for VBEModes.
	
2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAEnterVT):

	-Fix segfault on EnterVT when DRI is not enabled.
	 (Joris van Rantwijk)

2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_priv.h:
	* unichrome/via_swov.c: (VIAVidUpdateOverlay):
	* unichrome/via_video.c: (RegionsEqual), (viaReputImage),
	(viaSetupAdaptors), (VIAVidAdjustFrame):

	-Fix Xv panning. Speed up overlay updates on window moves.

2005-08-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_video.c: (viaExitVideo):

	-Fix stopvideo for all ports and adaptors.
	
2005-08-10  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/Imakefile:
	* unichrome/via_bios.h:
	* unichrome/via_ch7xxx.c: (CH7xxxPrintRegs), (ViaCH7xxxDetect),
	(CH7xxxSave), (CH7xxxRestore), (CH7xxxDACSenseI2C),
	(CH7xxxDACSense), (CH7011ModeIndex), (CH7019ModeIndex),
	(CH7xxxModeValid), (CH7xxxModeI2C), (CH7xxxModeCrtc),
	(CH7xxxTVPower), (CH7019LCDPower), (ViaCH7xxxInit):
	* unichrome/via_ch7xxx.h:
	* unichrome/via_driver.c: (VIAPreInit):
	* unichrome/via_id.c:
	* unichrome/via_mode.c: (ViaTVDetect), (ViaTVInit):
	* unichrome/via_vt162x.c: (ViaVT162xDetect), (VT1625DACSenseI2C),
	(VT1625DACSense), (VT1621ModeIndex), (VT1622ModeIndex),
	(VT1625ModeValid), (VT1622ModeI2C), (VT1622ModeCrtc),
	(VT1625Power), (ViaVT162xInit):
	* unichrome/via_vt162x.h:

        -Initial steps to incorporating CH7xxx and VT1625 support
        merging patches from David George, Philip Prindeville, Terry Lewis

2005-07-30  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* libxvmc/Imakefile:
	* unichrome/via_mode.c: (ViaGetMemoryBandwidth),
	(ViaModePrimaryVGA), (ViaModePrimary):
	* unichrome/via_swov.c:

	-Merge fixes from xorg for typos in mode setting and sync set

2005-07-18  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/via_id.c:

	-Additional card-id. Reported by Philip Prindeville

2005-07-04  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_driver.c: (VIAPreInit), (VIAScreenInit):
	* unichrome/via_id.c:

	-Avoid calling DPMS to blank screen during init with VBEModes
	-Add another card ID.
	
2005-06-29  Ivor Hewitt  <ivor-at-ivor-dot-org>

	* unichrome/via_id.c:

	-Additional card-ids. Patch from Xavier Bachelot
	
2005-06-26  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/viaLowLevelPro.c: (finish_header_agp), (syncDMA),
	(syncVideo), (pciFlush), (agpFlush), (uploadHQVDeinterlace),
	(uploadHQVShadow), (flushXvMCLowLevel), (flushPCIXvMCLowLevel),
	(viaMpegSetSurfaceStride), (viaVideoSetSWFLipLocked),
	(viaVideoSWFlipLocked), (viaMpegSetFB), (viaMpegBeginPicture),
	(viaMpegReset), (viaMpegWriteSlice), (viaVideoSubPictureOffLocked),
	(viaVideoSubPictureLocked), (viaBlit), (syncXvMCLowLevel),
	(releaseXvMCLowLevel), (initXvMCLowLevel), (closeXvMCLowLevel):

	-Clean up the VIDEO_DMA ifdef mess before xorg inclusion. 
	-Make VIDEO_DMA wait for DMA quiescent before flipping, pending proper
	 HQV locking.
	-Disable VIDEO_DMA to improve latency pending proper HQV locking.

2005-06-17  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_mode.c: (ViaSetPrimaryDotclock),
	(ViaSetSecondaryDotclock), (ViaComputeProDotClock),
	(ViaModeDotClockTranslate):

	- Free dotclock on Unichrome Pro. Pls report problems with 
	  unstable clocks.
	- Minor 64-bit fixes.

2005-06-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_xvmc.c: (ViaXvMCCreateContext),
	(ViaXvMCCreateSurface), (ViaXvMCCreateSubpicture):
	* unichrome/via_xvmc.h:

	- XvMC 64 bit fixes. XvMC now runs on K8M800 64-bit Linux.
	
2005-06-12  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_bios.h:
	* unichrome/via_i2c.c:
	* unichrome/via_mode.c: (ViaTVRestore):
	* unichrome/via_vt162x.c: (VT162xPrintRegs), (ViaVT162xDetect),
	(VT162xSave), (VT162xRestore), (ViaVT162xInit):

	- Fix up the vt1623 encoder: Correct device ID, number of registers
	  and most of all reading from the i2cbus it is sitting on.

2005-06-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIADRIScreenInit):

	- Update via_dri.c to compile with new libdri.
	
2005-06-01  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_mode.c: (ViaModePrimary):
	* unichrome/via_vt162x.h:

	- Fix TV-out on Unichrome Pro. To make it work CRT+TV needs to be
	  enabled in BIOS. Still it will hang the machine or possibly only
	  the display chip on X server exit.
	- Import the 720x576Noscale mode for vt1622A/vt1623 from the Unichrome
	  driver (Terry Barnaby)

2005-05-25  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/viaLowLevelPro.c: (setHQVDeinterlacing):
	* libxvmc/viaXvMC.c:
	* unichrome/via_driver.c:
	* unichrome/via_mode.c: (ViaModePrimary):
	* unichrome/via_mode.h:
	* unichrome/via_vt162x.c: (ViaVT162xDetect):

	- Updated incorrect field order in libViaXvMCPro.
	- Fixed warnings about unresolved int10 symbols in the Unichrome driver.
	- Updated Unichrome Pro dotclocks - also for TV.
	- Made the driver recognize the vt1623 TV encoder on the EPIA SP13000.
	- Removed unnecessary define in viaXvMC.c.
	
2005-05-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* libxvmc/driDrawable.c: (getDRIDrawableInfoLocked):
	* libxvmc/viaXvMC.c: (releaseContextResources),
	(XvMCCreateContext):
	* libxvmc/xf86dri.c: (uniDRIDestroyContext),
	(uniDRICreateDrawable), (uniDRIDestroyDrawable),
	(uniDRIGetDrawableInfo):
	* libxvmc/xf86dri.h:

	- Changed DRI client function names since they clash with
	  via_dri.so, causing strange problems in, for example, xine.
	
2005-05-16  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* unichrome/via_dri.c: (VIASetAgpMode), (VIADRIAgpInit):

	- Added better AGP mode control to the DDX.

2005-05-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>

	* prepare-ChangeLogSVN.pl:

	- Added the above file for generation of ChangeLog Entries.

	
2005-05-11  Thomas Hellström  <unichrome-at-shipmail-dot-org>
	
	* libxvmc/driDrawable.c:
	* libxvmc/viaLowLevel.c: (hwlLock), (hwlUnlock),
	(setAGPSyncLowLevel), (viaDMATimeStampLowLevel),
	(flushXvMCLowLevel), (flushPCIXvMCLowLevel),
	(viaMpegSetSurfaceStride), (viaVideoSetSWFLipLocked),
	(viaVideoSWFlipLocked), (viaMpegSetFB), (viaMpegBeginPicture),
	(viaMpegReset), (viaMpegWriteSlice), (viaVideoSubPictureOffLocked),
	(viaVideoSubPictureLocked), (viaBlit), (syncXvMCLowLevel),
	(initXvMCLowLevel), (setLowLevelLocking), (closeXvMCLowLevel):
	* libxvmc/viaLowLevel.h:
	* libxvmc/viaLowLevelPro.c: (initHQVShadow),
	(setHQVHWDeinterlacing), (setHQVDeblocking), (setHQVStartAddress),
	(setHQVColorSpaceConversion), (setHQVFetchLine), (setHQVScale),
	(setHQVSingleDestination), (setHQVDeinterlacing),
	(setHQVTripleBuffer), (hwlLock), (hwlUnlock), (setAGPSyncLowLevel),
	(viaDMATimeStampLowLevel), (viaDMAInitTimeStamp),
	(uploadHQVDeinterlace), (uploadHQVShadow), (flushXvMCLowLevel),
	(flushPCIXvMCLowLevel), (viaMpegSetSurfaceStride),
	(viaVideoSetSWFLipLocked), (viaVideoSWFlipLocked), (viaMpegSetFB),
	(viaMpegBeginPicture), (viaMpegReset), (viaMpegWriteSlice),
	(viaVideoSubPictureOffLocked), (viaVideoSubPictureLocked),
	(viaBlit), (syncXvMCLowLevel), (updateLowLevelBuf),
	(cleanupLowLevelBuf), (initXvMCLowLevel), (setLowLevelLocking),
	(closeXvMCLowLevel), (computeDownScaling),
	(computeHQVScaleAndFilter), (setupBackBuffer):
	* libxvmc/viaXvMC.c: (grabDecoder), (releaseContextResources),
	(XvMCCreateContext), (XvMCCreateSurface), (XvMCPutSlice2),
	(XvMCPutSlice), (XvMCPutSurface), (XvMCBeginSurface),
	(XvMCSyncSurface), (XvMCLoadQMatrix), (XvMCCreateSubpicture),
	(XvMCSetSubpicturePalette), (XvMCClearSubpicture),
	(XvMCCompositeSubpicture), (XvMCBlendSubpicture2),
	(XvMCSyncSubpicture), (XvMCDestroySubpicture), (XvMCFlushSurface),
	(XvMCGetSurfaceStatus), (XvMCQueryAttributes), (XvMCSetAttribute),
	(XvMCGetAttribute), (XvMCHideSurface):
	* libxvmc/viaXvMCPriv.h:
	* unichrome/via_swov.c: (ViaSwovSurfaceCreate):
	* unichrome/via_video.c: (viaSetupAdaptors):
	* unichrome/via_xvpriv.h:

	- Added ChangeLog to the repository.
	- Made the DDX update the overlay if a change in surface format occured
	  while it's dimensions are still the same.
	- Made the XvMCLowLevel struct opaque (void *) and not defined in the 
	  header file. This allows for different definitions for different hardware
	- Added a HQV shadow which holds the HQV context for the Unichrome Pro. 
	  The purpose is twofold:
	  1. If someone else touched the HQV since we last used it, we can upload the
	     whole context.
	  2. We do not need to read from the HQV, which is bad because we have to 
	     halt the DMA engine to do that.
	- Added and activated mpeg deblocking for Unichrome Pro.
	- Added a number of HQV utility functions for the upcoming video engine free
	  output. These are not activated yet. (Unichrome Pro.)
	- Added HW deinterlacing functions. Deactivated, since I cannot see any visible
	  difference. (Unichrome Pro.)
